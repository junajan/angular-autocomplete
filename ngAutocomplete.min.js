"use strict";angular.module("ngAutocomplete",["ng"]).directive("autocomplete",["$compile","$timeout","$document",function(e,t,n){return{restrict:"E",replace:true,scope:{searchCallback:"=",attributeName:"=?",searchDelay:"=?",maxResultSize:"=?",ngModel:"="},template:"<span class='livesearch'><input type='text' ng-blur='blurInput()' /></span>",link:function(r,i,s,o){var u;var a=1;var f=9;var l;r.results=[];r.visible=false;r.selectedIndex=-1;n.on("click",function(){r.$apply(function(){r.$eval(r.hideResults)})});r.hideResults=function(){r.visible=false};r.blurInput=function(){r.ngModel={}};r.select=function(e){r.selectedIndex=e;r.visible=false};r.isSelected=function(e){return r.selectedIndex===e};r.init=function(){l=i.find("input");r.$watch("selectedIndex",function(e,t){var n=r.results[e];if(n){if(s.attributeName){l.val(n[s.attributeName])}else{l.val(n)}}r.ngModel=n});r.$watch("visible",function(e,t){if(e==false){return}});l[0].onkeydown=function(e){if(e.keyCode==40){if(r.selectedIndex+1===r.results.length){r.selectedIndex=0}else{r.selectedIndex++}}else if(e.keyCode==38){if(r.selectedIndex==0){r.selectedIndex=r.results.length-1}else if(r.selectedIndex==-1){r.selectedIndex=0}else r.selectedIndex--}if(e.keyCode==13){r.visible=false}r.$apply()};l[0].onkeyup=function(e){if(e.keyCode==13||e.keyCode==37||e.keyCode==38||e.keyCode==39||e.keyCode==40){return false}var n=i.find("input");t.cancel(u);var s=n.val().split(",");var o=s[s.length-1].trim();if(o.length<a||o.length>f){r.visible=false;r.$apply();return}u=t(function(){var e=[];var t=r.searchCallback.call(null,{query:o});t.then(function(t){if(t){e=t.slice(0,(r.maxResultSize||20)-1)}if(e.length)r.visible=true});t.finally(function(){r.selectedIndex=-1;r.results=e.filter(function(t,n){return e.indexOf(t)==n})})},r.searchDelay||100)}};var c=i.attr("result-template")||"{{result}}";var h="<ul ng-show='visible && results.length' class='searchresultspopup'><li ng-class=\"{ 'selected' : isSelected($index) }\" ng-click='select($index)' ng-repeat='result in results'>"+c+"</li></ul>";var p=e(h)(r);i.append(p[0]);t(r.init)}}}])